# Supabase Storage è®¾ç½®æŒ‡å—

## ğŸ“‹ ä¸ºä»€ä¹ˆéœ€è¦ Storageï¼Ÿ

å½“ç”¨æˆ·ä¸Šä¼ ç‰©å“å›¾ç‰‡æ—¶ï¼Œç³»ç»Ÿä¼šå°è¯•å°† base64 æ ¼å¼çš„å›¾ç‰‡ä¸Šä¼ åˆ° Supabase Storageï¼Œè¿™æ ·å¯ä»¥ï¼š
- å‡å°‘æ•°æ®åº“å­˜å‚¨å‹åŠ›
- æé«˜å›¾ç‰‡åŠ è½½é€Ÿåº¦
- æ›´å¥½çš„å›¾ç‰‡ç®¡ç†

**æ³¨æ„**ï¼šå¦‚æœ Storage æœªé…ç½®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ base64 æ ¼å¼å­˜å‚¨ï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰ã€‚

## ğŸ”§ è®¾ç½®æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»º Storage Bucket

1. **ç™»å½• Supabase Dashboard**
   - è®¿é—® https://app.supabase.com
   - é€‰æ‹©ä½ çš„é¡¹ç›®

2. **è¿›å…¥ Storage**
   - ç‚¹å‡»å·¦ä¾§èœå•çš„ "Storage"
   - ç‚¹å‡» "New bucket" æŒ‰é’®

3. **é…ç½® Bucket**
   - **Name**: `item-images`ï¼ˆå¿…é¡»ä½¿ç”¨è¿™ä¸ªåç§°ï¼‰
   - **Public bucket**: âœ… **å‹¾é€‰**ï¼ˆé‡è¦ï¼è¿™æ ·å›¾ç‰‡æ‰èƒ½å…¬å¼€è®¿é—®ï¼‰
   - ç‚¹å‡» "Create bucket"

### æ­¥éª¤ 2: è®¾ç½® Bucket æƒé™ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æ›´ç²¾ç»†çš„æƒé™æ§åˆ¶ï¼š

1. **è¿›å…¥ Bucket è®¾ç½®**
   - ç‚¹å‡» `item-images` bucket
   - ç‚¹å‡» "Policies" æ ‡ç­¾

2. **åˆ›å»ºä¸Šä¼ ç­–ç•¥**ï¼ˆå¦‚æœéœ€è¦ç”¨æˆ·ç›´æ¥ä¸Šä¼ ï¼‰
   ```sql
   -- å…è®¸è®¤è¯ç”¨æˆ·ä¸Šä¼ 
   CREATE POLICY "Allow authenticated uploads"
   ON storage.objects FOR INSERT
   TO authenticated
   WITH CHECK (bucket_id = 'item-images');
   ```

3. **åˆ›å»ºè¯»å–ç­–ç•¥**ï¼ˆå¦‚æœéœ€è¦ï¼‰
   ```sql
   -- å…è®¸æ‰€æœ‰äººè¯»å–ï¼ˆå› ä¸º bucket æ˜¯å…¬å¼€çš„ï¼‰
   CREATE POLICY "Allow public reads"
   ON storage.objects FOR SELECT
   TO public
   USING (bucket_id = 'item-images');
   ```

**æ³¨æ„**ï¼šå¦‚æœ bucket è®¾ç½®ä¸ºå…¬å¼€ï¼Œé€šå¸¸ä¸éœ€è¦é¢å¤–çš„è¯»å–ç­–ç•¥ã€‚

### æ­¥éª¤ 3: éªŒè¯è®¾ç½®

1. **æµ‹è¯•ä¸Šä¼ **
   - åœ¨åº”ç”¨ä¸­å°è¯•æ·»åŠ ä¸€ä¸ªæ–°ç‰©å“
   - ä¸Šä¼ ä¸€å¼ å›¾ç‰‡
   - æ£€æŸ¥æ˜¯å¦æˆåŠŸåˆ›å»ºç‰©å“

2. **æ£€æŸ¥ Storage**
   - åœ¨ Supabase Dashboard â†’ Storage â†’ `item-images`
   - åº”è¯¥èƒ½çœ‹åˆ°ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶

3. **æ£€æŸ¥å›¾ç‰‡ URL**
   - åœ¨æ•°æ®åº“ä¸­æŸ¥çœ‹ `items` è¡¨çš„ `image_url` å­—æ®µ
   - åº”è¯¥æ˜¯ä¸€ä¸ª Supabase Storage URLï¼ˆæ ¼å¼ï¼š`https://xxx.supabase.co/storage/v1/object/public/item-images/xxx.jpg`ï¼‰

## âš ï¸ å¸¸è§é—®é¢˜

### 1. "Bucket not found" é”™è¯¯

**åŸå› **ï¼šBucket åç§°ä¸åŒ¹é…æˆ–æœªåˆ›å»º

**è§£å†³**ï¼š
- ç¡®è®¤ bucket åç§°æ˜¯ `item-images`ï¼ˆå®Œå…¨åŒ¹é…ï¼‰
- ç¡®è®¤ bucket å·²åˆ›å»º
- æ£€æŸ¥ Supabase é¡¹ç›®æ˜¯å¦æ­£ç¡®

### 2. "Permission denied" é”™è¯¯

**åŸå› **ï¼šBucket æƒé™è®¾ç½®ä¸æ­£ç¡®

**è§£å†³**ï¼š
- ç¡®è®¤ bucket è®¾ç½®ä¸º "Public bucket"
- æˆ–è€…æ·»åŠ ç›¸åº”çš„ç­–ç•¥ï¼ˆè§æ­¥éª¤ 2ï¼‰

### 3. å›¾ç‰‡ä»ç„¶ä½¿ç”¨ base64 æ ¼å¼

**åŸå› **ï¼šStorage ä¸Šä¼ å¤±è´¥ï¼Œç³»ç»Ÿè‡ªåŠ¨å›é€€åˆ° base64

**è§£å†³**ï¼š
- æ£€æŸ¥ Supabase Storage é…ç½®
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
- ç¡®è®¤ `SUPABASE_SERVICE_ROLE_KEY` ç¯å¢ƒå˜é‡å·²é…ç½®

### 4. å›¾ç‰‡æ— æ³•æ˜¾ç¤º

**åŸå› **ï¼šå›¾ç‰‡ URL ä¸æ­£ç¡®æˆ– bucket æœªè®¾ç½®ä¸ºå…¬å¼€

**è§£å†³**ï¼š
- ç¡®è®¤ bucket è®¾ç½®ä¸º "Public bucket"
- æ£€æŸ¥å›¾ç‰‡ URL æ ¼å¼æ˜¯å¦æ­£ç¡®
- åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®å›¾ç‰‡ URL æµ‹è¯•

## ğŸ“ æ€»ç»“

**å¿…éœ€é…ç½®**ï¼š
- âœ… åˆ›å»º `item-images` bucket
- âœ… è®¾ç½®ä¸º "Public bucket"
- âœ… é…ç½® `SUPABASE_SERVICE_ROLE_KEY` ç¯å¢ƒå˜é‡

**å¯é€‰é…ç½®**ï¼š
- âš™ï¸ æ·»åŠ è‡ªå®šä¹‰æƒé™ç­–ç•¥
- ğŸ“Š è®¾ç½®å­˜å‚¨é™åˆ¶

é…ç½®å®Œæˆåï¼Œç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ° Supabase Storageï¼Œè€Œä¸æ˜¯ä»¥ base64 æ ¼å¼å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚

