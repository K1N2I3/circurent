# 🔍 邮件配置调试指南

## 问题：配置后仍然无法发送邮件

### 步骤 1: 检查 Vercel 环境变量

1. **访问 Vercel Dashboard**
   - https://vercel.com/dashboard
   - 选择项目 `circurent`
   - Settings → Environment Variables

2. **确认以下变量存在且值正确**：
   ```
   RESEND_API_KEY = re_AcovjuaR_5JpoEbpeGfiDpGgQS6vDrLyg
   RESEND_FROM_EMAIL = CircuRent <noreply@circurent.it>
   ```

3. **重要检查项**：
   - ✅ 变量名完全匹配（区分大小写）
   - ✅ 值没有多余的空格
   - ✅ 已勾选 Production、Preview、Development 三个环境
   - ✅ 点击了 "Save" 保存

### 步骤 2: 使用调试接口检查配置

访问以下 URL 检查环境变量是否正确加载：

```
https://your-app.vercel.app/api/debug/email-config
```

或者如果是本地开发：
```
http://localhost:3000/api/debug/email-config
```

**期望结果**：
```json
{
  "status": "ok",
  "config": {
    "resendApiKey": "re_AcovjuaR...Lyg (32 chars)",
    "resendFromEmail": "CircuRent <noreply@circurent.it>"
  },
  "checks": {
    "hasApiKey": true,
    "hasFromEmail": true,
    "isConfigured": true
  }
}
```

**如果显示 "NOT SET"**：
- 说明环境变量未正确配置
- 返回步骤 1 重新配置

### 步骤 3: 检查 Vercel 部署日志

1. **在 Vercel Dashboard**：
   - 进入 Deployments
   - 点击最新的部署
   - 查看 Functions 标签

2. **查找邮件发送相关的日志**：
   - 搜索 "Attempting to send email"
   - 查看是否有错误信息
   - 检查 "From" 字段是否正确

3. **常见错误信息**：

   **错误 1: "only send testing emails to your own email address"**
   - 原因：未使用已验证的域名
   - 解决：确认 `RESEND_FROM_EMAIL` 使用的是 `noreply@circurent.it`

   **错误 2: "domain not verified"**
   - 原因：域名验证状态有问题
   - 解决：检查 https://resend.com/domains 确认域名状态

   **错误 3: "API key invalid"**
   - 原因：API Key 错误或过期
   - 解决：重新生成 API Key 并更新

### 步骤 4: 检查 Resend Dashboard

1. **访问 Resend Dashboard**：
   - https://resend.com/emails
   - 查看邮件发送记录

2. **检查项**：
   - 是否有发送记录？
   - 发送状态是什么？（成功/失败）
   - 如果失败，错误信息是什么？

3. **检查域名状态**：
   - https://resend.com/domains
   - 确认 `circurent.it` 显示为 "Verified"

### 步骤 5: 强制重新部署

如果环境变量已配置但似乎未生效：

1. **在 Vercel Dashboard**：
   - Deployments → 最新部署
   - 点击 "..." → "Redeploy"
   - 选择 "Use existing Build Cache" = No（清除缓存）
   - 点击 "Redeploy"

2. **等待部署完成**（通常 1-2 分钟）

3. **再次测试**：
   - 使用任意邮箱地址注册
   - 检查是否收到邮件

### 步骤 6: 验证邮件发送

1. **使用测试邮箱注册**：
   - 访问应用注册页面
   - 使用**非 hudefei1979@gmail.com** 的邮箱
   - 例如：test@example.com

2. **检查邮箱**：
   - 收件箱
   - 垃圾邮件文件夹
   - 发送者应该是：`CircuRent <noreply@circurent.it>`

3. **检查 Resend Dashboard**：
   - 应该能看到新的发送记录
   - 状态应该是 "Delivered"

## 🚨 常见问题排查

### Q1: 环境变量已配置但仍显示 "NOT SET"

**可能原因**：
- 未重新部署
- 环境变量名称拼写错误
- 未选择正确的环境（Production/Preview/Development）

**解决方法**：
1. 删除并重新添加环境变量
2. 确保勾选所有环境
3. 强制重新部署（不使用缓存）

### Q2: 只能发送到特定邮箱

**可能原因**：
- 仍在使用 `onboarding@resend.dev`
- `RESEND_FROM_EMAIL` 未正确配置

**解决方法**：
1. 确认 `RESEND_FROM_EMAIL = CircuRent <noreply@circurent.it>`
2. 不要使用 `onboarding@resend.dev`
3. 重新部署

### Q3: 邮件发送成功但收不到

**可能原因**：
- 邮件被标记为垃圾邮件
- 邮箱地址错误
- 邮件服务商延迟

**解决方法**：
1. 检查垃圾邮件文件夹
2. 在 Resend Dashboard 查看发送状态
3. 尝试发送到不同的邮箱服务商（Gmail、Outlook 等）

## 📞 需要更多帮助？

如果以上步骤都无法解决问题，请提供：
1. 调试接口的返回结果（`/api/debug/email-config`）
2. Vercel 函数日志中的错误信息
3. Resend Dashboard 中的邮件发送记录

